description "Starphleet order has been updated via git, make config changes"

instance $local

stop on stopping starphleet

script
  #there has been a update. yeah! make sure there is a docker image for it
  #named with the SHA of the update. Yeah SHA, these are uniqe tags, but don't
  #get them confused with the SHA that Docker makes for the resulting image
  cd ${local}
  CURRENT_SHA=`git log -n 1 --no-merges --pretty=format:%H`
  EXISTING=$(docker images | grep ${CURRENT_SHA})
  if [ "${EXISTING}" ]; then
    echo image is already available
  else
    docker build -t ${CURRENT_SHA} .
  fi
end script
