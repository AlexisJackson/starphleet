#!/usr/bin/env bash

#this is a provisioning script, it is designed to be run under Vagrant
#as root, with the starphleet source tree at /starphleet

#get docker on
apt-get -y install --force-yes git curl apt-transport-https
curl http://get.docker.io/gpg | apt-key add -
echo "deb https://get.docker.io/ubuntu docker main" \
  > /etc/apt/sources.list.d/docker.list
apt-get -y update
apt-get -y install --force-yes linux-image-extra-`uname -r`
apt-get -y install --force-yes lxc-docker

#hit docker once as root,
#make the socket appear, and then loose up the permissions
docker images
groupadd docker
gpasswd -a vagrant docker
chmod 0777 /var/run/docker.sock

#starphleet itself, which is just a container, TURTLES!
docker build -t node.v0.10.17 - < /starphleet/dockerfiles/node.v0.10.17
/starphleet/provision/phleet


echo *built*
