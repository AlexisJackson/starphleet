#!/usr/bin/env starphleet-launcher
### Usage:
###    starphleet-orphan-reaper
### --help
###
### Look through all containers stopped or running and run reaper
### against any missing a current set of orders
die_on_error
run_as_root_or_die

# Go through all containers and reap any orphans
for container in $(lxc-ls); do
  # Ignore starphleet-base
  if [ $container == "starphleet-base" ]; then
    continue
  fi
  # Yank the sha(s) off the container
  SERVICE=$(echo ${container:0:${#container}-16})
  # If no orders correspond with the service - reap it
  [ ! -d "${HEADQUARTERS_LOCAL}/${SERVICE}" ] && starphleet-reaper zzzzzzzzz "${SERVICE}"
done
